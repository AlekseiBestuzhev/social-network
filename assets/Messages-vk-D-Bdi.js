import{r as l,D as j,j as s,A as S,m as d,W as k,M as C,O as M,Q as U,k as w,X as b,Y as A,Z as I,N as $,l as R,U as q,_ as z,$ as y}from"./index-iNpgpxSW.js";import{w as E}from"./withAuthRedirect-5xLrqztY.js";import{A as B}from"./AddItemForm-J8x0IZTh.js";const P=""+new URL("messages-nmnGQinb.gif",import.meta.url).href,F=""+new URL("messages-OsCJtZlD.webp",import.meta.url).href,J="_wrapper_3g3eu_1",O="_header_3g3eu_6",T="_name_3g3eu_14",Q="_menuIcon_3g3eu_18",X="_formWrapper_3g3eu_28",g={wrapper:J,header:O,name:T,menuIcon:Q,formWrapper:X},Z=""+new URL("dialog-U1J0sBXe.gif",import.meta.url).href,G=""+new URL("dialog-Fkarh3WE.webp",import.meta.url).href,H="_dialogMessages_v3074_1",V="_chat_v3074_10",Y="_scrollAnchor_v3074_13",x={dialogMessages:H,chat:V,scrollAnchor:Y},K="_wrapper_p2faq_1",ss="_name_p2faq_8",es="_message_p2faq_15",as="_time_p2faq_34",ts="_iSender_p2faq_39",_={wrapper:K,name:ss,message:es,time:as,iSender:ts},ns=l.memo(({message:e,iSender:n,time:o,chat:a,photo:t,userName:r})=>{const c=j(_.wrapper,{[_.iSender]:n});return s.jsxs("div",{className:c,children:[a&&s.jsx(S,{photo:t,size:"3.2rem"}),a&&s.jsx("p",{className:_.name,children:r}),s.jsx("div",{className:_.message,children:e}),s.jsx("p",{className:_.time,children:o})]})}),D=e=>e.messagesPage.messagesData,os=l.memo(({authUserId:e,userID:n})=>{const o=l.useRef(null),a=d(D)[n],t=n==="dev_chat",r=j(x.dialogMessages,t&&x.chat),c=()=>{var m;(m=o.current)==null||m.scrollIntoView({behavior:"smooth"})};return l.useEffect(()=>{c()},[a]),s.jsxs("div",{className:r,children:[a.length?a.map(({id:m,...p})=>{const u=p.userId==="authUser"||p.userId===e;return s.jsx(ns,{id:m,...p,iSender:u,chat:t},m)}):s.jsx(k,{text:"Write a message to start chatting...",picture:Z,pictureWebp:G}),s.jsx("div",{ref:o,className:x.scrollAnchor})]})}),L=e=>e.messagesPage.dialogsData,cs=l.memo(({userID:e,socket:n})=>{var N;const o=d(C),a=((N=d(M))==null?void 0:N.toString())||"",t=d(U),c=d(L).find(h=>h.id===e),m=(c==null?void 0:c.name)||"",p=w(),u=({message:h})=>{if(e==="dev_chat"&&n instanceof WebSocket)n.send(h);else if(a&&o){const W={message:h,userId:a.toString(),userName:o,photo:t,toUser:e};p(I(W))}};return s.jsxs("div",{className:g.wrapper,children:[s.jsxs("div",{className:g.header,children:[s.jsx("h4",{className:g.name,children:m}),s.jsx(b,{className:g.menuIcon,onClick:()=>alert("There will be a drop-down list")})]}),s.jsx(os,{userID:e,authUserId:a}),s.jsx("div",{className:g.formWrapper,children:s.jsxs(B,{placeholder:"Enter a message...",onSubmit:u,children:["Send ",s.jsx(A,{})]})})]})}),rs="_dialog_1eurz_1",is="_link_1eurz_9",ls="_textBlock_1eurz_17",ms="_topLine_1eurz_20",ds="_name_1eurz_24",ps="_lastMessage_1eurz_28",gs="_activeLink_1eurz_34",i={dialog:rs,link:is,textBlock:ls,topLine:ms,name:ds,lastMessage:ps,activeLink:gs},_s=l.memo(({id:e,name:n,photo:o,lastMessage:a,lastDate:t})=>{const r=({isActive:c})=>j(i.link,{[i.activeLink]:c});return s.jsx("li",{className:i.dialog,children:s.jsxs($,{to:`${R.messages}/${e}`,className:r,children:[s.jsx(S,{photo:o,size:"3.5rem"}),s.jsxs("div",{className:i.textBlock,children:[s.jsxs("div",{className:i.topLine,children:[s.jsx("p",{className:i.name,children:n}),s.jsx("p",{className:i.date,children:t.slice(0,-5)})]}),s.jsx("p",{className:i.lastMessage,children:a})]})]})})}),hs="_dialogItems_m4u6p_1",us="_emptyList_m4u6p_6",v={dialogItems:hs,emptyList:us},xs=()=>{const e=d(L),n=d(D),o=e.length?e.map(a=>{const t=n[a.id][n[a.id].length-1],r=(t==null?void 0:t.message)||"",c=(t==null?void 0:t.date)||"";return s.jsx(_s,{id:a.id,name:a.name,photo:a.photo,lastMessage:r,lastDate:c},a.id)}):s.jsx("span",{className:v.emptyList,children:"Nobody needs you..."});return s.jsx("ul",{className:v.dialogItems,children:o})},fs="_page_1qx8j_1",js="_leftColumn_1qx8j_6",Ns="_title_1qx8j_9",vs="_rightColumn_1qx8j_17",Ss="_formWrapper_1qx8j_22",f={page:fs,leftColumn:js,title:Ns,rightColumn:vs,formWrapper:Ss},Ls=E(()=>{const[e,n]=l.useState(null),o=w(),{userID:a}=q();return l.useEffect(()=>{if(!e){console.log("connect");const t=new WebSocket("wss://social-network.samuraijs.com/handlers/ChatHandler.ashx");n(t)}return()=>{e instanceof WebSocket&&(o(z()),e.close(),n(null))}},[e]),e instanceof WebSocket&&(e.onmessage=t=>{const r=JSON.parse(t.data);o(y(r))}),s.jsxs("div",{className:f.page,children:[s.jsxs("div",{className:f.leftColumn,children:[s.jsx("h2",{className:f.title,children:"Dialogs"}),s.jsx(xs,{})]}),a?s.jsx(cs,{userID:a,socket:e}):s.jsx(k,{text:"Choose the dialog...",picture:P,pictureWebp:F,size:"16rem"})]})});export{Ls as Messages};
